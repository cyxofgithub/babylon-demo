<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <title>Babylon.js sample code</title>

        <!-- Babylon.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://assets.babylonjs.com/generated/Assets.js"></script>
        <script src="https://cdn.babylonjs.com/recast.js"></script>
        <script src="https://cdn.babylonjs.com/ammo.js"></script>
        <script src="https://cdn.babylonjs.com/havok/HavokPhysics_umd.js"></script>
        <script src="https://cdn.babylonjs.com/cannon.js"></script>
        <script src="https://cdn.babylonjs.com/Oimo.js"></script>
        <script src="https://cdn.babylonjs.com/earcut.min.js"></script>
        <script src="https://cdn.babylonjs.com/babylon.js"></script>
        <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://cdn.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://cdn.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://cdn.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://cdn.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

        <style>
            html,
            body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }

            #canvasZone {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div id="canvasZone"><canvas id="renderCanvas"></canvas></div>
        <script>
            var canvas = document.getElementById("renderCanvas");

            var startRenderLoop = function (engine, canvas) {
                engine.runRenderLoop(function () {
                    if (sceneToRender && sceneToRender.activeCamera) {
                        sceneToRender.render();
                    }
                });
            };

            var engine = null;
            var scene = null;
            var sceneToRender = null;
            var createDefaultEngine = function () {
                return new BABYLON.Engine(canvas, true, {
                    preserveDrawingBuffer: true,
                    stencil: true,
                    disableWebGL2Support: false,
                });
            };
            const createScene = () => {
                const scene = new BABYLON.Scene(engine);

                /**** Set camera and light *****/
                const camera = new BABYLON.ArcRotateCamera(
                    "camera",
                    -Math.PI / 2,
                    Math.PI / 2.5,
                    10,
                    new BABYLON.Vector3(0, 0, 0)
                );
                camera.attachControl(canvas, true);
                const light = new BABYLON.HemisphericLight(
                    "light",
                    new BABYLON.Vector3(1, 1, 0)
                );

                const boxMat = new BABYLON.StandardMaterial("boxMat");
                boxMat.diffuseTexture = new BABYLON.Texture(
                    "https://www.babylonjs-playground.com/textures/floor.png"
                );

                /**** World Objects *****/
                const box = BABYLON.MeshBuilder.CreateBox("box", {});
                box.material = boxMat;
                box.position.y = 0.5;

                const axisThickness = 0.1; // 线段粗细
                const arrowSize = 0.3; // 箭头大小

                const xAxisPoints = [
                    new BABYLON.Vector3(0, 0, 0),
                    new BABYLON.Vector3(2, 0, 0),
                ];

                const zAxisPoints = [
                    new BABYLON.Vector3(0, 0, 0),
                    new BABYLON.Vector3(0, 0, 2),
                ];

                const xAxis = BABYLON.MeshBuilder.CreateTube("xAxis", {
                    path: xAxisPoints,
                    radius: axisThickness,
                });
                xAxis.position = new BABYLON.Vector3(0, -0.4, 0); // 设置 x 轴位置

                const zAxis = BABYLON.MeshBuilder.CreateTube("zAxis", {
                    path: zAxisPoints,
                    radius: axisThickness,
                });
                zAxis.position = new BABYLON.Vector3(0, -0.4, 0); // 设置 x 轴位置

                const xAxisMaterial = new BABYLON.StandardMaterial(
                    "xAxisMaterial",
                    scene
                );
                xAxisMaterial.diffuseColor = new BABYLON.Color3(1, 0, 0); // 设置 x 轴颜色为红色

                const zAxisMaterial = new BABYLON.StandardMaterial(
                    "zAxisMaterial",
                    scene
                );
                zAxisMaterial.diffuseColor = new BABYLON.Color3(0, 0, 1); // 设置 z 轴颜色为蓝色

                xAxis.material = xAxisMaterial;
                zAxis.material = zAxisMaterial;

                // 创建箭头
                const arrowHead = BABYLON.MeshBuilder.CreateCylinder(
                    "arrowHead",
                    {
                        height: arrowSize,
                        diameterTop: 0,
                        diameterBottom: arrowSize * 0.8,
                    }
                );
                arrowHead.rotation.x = Math.PI / 2; // 旋转箭头使其朝向正方向
                arrowHead.visibility = 0; // 使箭头半透明

                // 将箭头与线段连接并附加到盒子
                const xArrow = arrowHead.clone();
                xArrow.visibility = 1;
                xArrow.parent = xAxis;
                xArrow.position = new BABYLON.Vector3(2.16, 0, 0); // 设置箭头位置

                const zArrow = arrowHead.clone();
                zArrow.visibility = 1;
                zArrow.parent = zAxis;
                zArrow.position = new BABYLON.Vector3(0, 0, 2.16);

                // 将线段和箭头附加到盒子
                xAxis.parent = box;
                zAxis.parent = box;

                // 旋转箭头的方向
                xArrow.rotation.y = Math.PI / 2; // 将 x 轴箭头旋转 90 度
                zArrow.rotation.x = Math.PI / 2; // 将 z 轴箭头旋转 90 度

                const ground = BABYLON.MeshBuilder.CreateGround("ground", {
                    width: 10,
                    height: 10,
                });

                // scene.actionManager = new BABYLON.ActionManager(scene);
                scene.debugLayer.show();
                return scene;
            };

            window.initFunction = async function () {
                var asyncEngineCreation = async function () {
                    try {
                        return createDefaultEngine();
                    } catch (e) {
                        console.log(
                            "the available createEngine function failed. Creating the default engine instead"
                        );
                        return createDefaultEngine();
                    }
                };

                window.engine = await asyncEngineCreation();
                if (!engine) throw "engine should not be null.";
                startRenderLoop(engine, canvas);
                window.scene = createScene();
            };
            initFunction().then(() => {
                sceneToRender = scene;
            });

            // Resize
            window.addEventListener("resize", function () {
                engine.resize();
            });
        </script>
    </body>
</html>
